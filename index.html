<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Content Manager</title>
</head>
<body>

<!-- ðŸ”¹ Debug Panel -->
<script>
(function () {
  const panel = document.createElement('div');
  panel.id = 'debug-panel';
  panel.style = 'position:fixed;left:8px;bottom:8px;z-index:99999;background:#111;color:#fff;padding:8px;font-size:12px;border-radius:6px;opacity:.85;max-width:320px';
  panel.innerHTML = '<strong>Auth Debug</strong><div id="debug-log" style="margin-top:6px"></div><button id="debug-test" style="margin-top:6px">Simulate token</button>';
  document.addEventListener('DOMContentLoaded', () => document.body.appendChild(panel));
  function log(m){ const el=document.getElementById('debug-log'); if(!el)return; el.innerHTML += '<div style="margin-top:4px;">'+String(m)+'</div>'; }
  log('Stored token: ' + (localStorage.getItem('github_token') || 'â€”noneâ€”'));
  window.addEventListener('message', e => log('message from ' + e.origin + ': ' + (typeof e.data === 'string' ? e.data : JSON.stringify(e.data))));
  document.addEventListener('click', e => {
    if (e.target && e.target.id === 'debug-test') {
      const payload = JSON.stringify({ token: 'TEST_TOKEN_PLACEHOLDER' });
      window.postMessage(`authorization:github:success:${payload}`, window.location.origin);
      log('Emitted simulated authorization message');
    }
  });
})();
</script>

<!-- ðŸ”¹ Token from URL hash (fallback for redirect-based auth) -->
<script>
(function () {
  const m = (location.hash || "").match(/\baccess_token=([^&]+)/);
  if (m) {
    try {
      localStorage.setItem("github_token", decodeURIComponent(m[1]));
    } catch (_) {}
    history.replaceState(null, "", location.pathname + location.search);
  }
})();
</script>

<!-- ðŸ”¹ Editor Shell -->
<div id="editor-shell" style="display:none; padding:12px;">
  <h2>Edit Content</h2>
  <textarea id="editor" style="width:100%; min-height:60vh;">Loading...</textarea>
  <button id="save-btn" style="margin-top:12px;">Save</button>
  <div id="editor-status" style="margin-top:8px; font-size:12px; opacity:0.7;"></div>
</div>

<!-- ðŸ”¹ Editor Loader -->
<script>
(function () {
  const token = localStorage.getItem('github_token');
  if (!token) return;

  // Show editor shell
  document.getElementById('editor-shell').style.display = 'block';

  // Load TinyMCE
  const script = document.createElement('script');
  script.src = 'https://cdn.tiny.cloud/1/w01ntc48o7kxzwys5kxk0gibj7s4lysx998e1rdgb1tjhm6y/tinymce/8/tinymce.min.js';
  script.referrerPolicy = 'origin';
  script.crossOrigin = 'anonymous';
  script.onload = () => {
    tinymce.init({
      selector: '#editor',
      plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount',
      toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table | align lineheight | numlist bullist indent outdent | emoticons charmap | removeformat',
      setup: (editor) => {
        editor.on('init', () => {
          document.getElementById('editor-status').textContent = 'Editor ready.';
        });
      }
    });
  };
  document.body.appendChild(script);

  // Save button simulation
  document.getElementById('save-btn').addEventListener('click', () => {
    const content = tinymce.activeEditor.getContent();
    document.getElementById('editor-status').textContent = 'Saving...';
    setTimeout(() => {
      document.getElementById('editor-status').textContent = 'Saved (simulated).';
    }, 1000);
  });
})();
</script>

</body>
</html>
