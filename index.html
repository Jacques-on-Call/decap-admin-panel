<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Content Manager</title>
  <link href="/config.yml" type="text/yaml" rel="cms-config-url">
  <style>
    /*
      Custom CSS for improving Decap CMS mobile layout and fixing overflow.
    */
    @media (max-width: 768px) {
      /*
        Target the main sidebar in Decap CMS to make it more compact.
      */
      #nc-root > div > section:first-of-type {
        width: 180px !important;
        min-width: 180px !important;
      }

      /*
        Adjust the main content area to account for the smaller sidebar.
      */
      #nc-root > div > main {
        padding-left: 180px !important;
      }

      /*
        Target the main editor header to fix overflow by allowing wrapping.
      */
      #nc-root header {
        flex-wrap: wrap !important;
        padding: 8px !important;
        min-width: 0;
      }
    }
  </style>
</head>
<body>

<!-- ðŸ”¹ 1. Debug Panel (conditionally shown via ?debug=true) -->
<script>
(function () {
  // Only show the debug panel if the ?debug query parameter is present
  if (new URLSearchParams(window.location.search).has('debug')) {
    const panel = document.createElement('div');
    panel.id = 'decap-debug';
    panel.style = 'position:fixed;left:8px;bottom:8px;z-index:99999;background:#111;color:#fff;padding:8px;font-size:12px;border-radius:6px;opacity:.85;max-width:320px';
    panel.innerHTML = '<strong>Decap Debug</strong><div id="decap-debug-log" style="margin-top:6px"></div><button id="decap-debug-test" style="margin-top:6px">Simulate message</button>';
    document.addEventListener('DOMContentLoaded', () => document.body.appendChild(panel));
    function log(m){ const el=document.getElementById('decap-debug-log'); if(!el)return; el.innerHTML += '<div style="margin-top:4px;">'+String(m)+'</div>'; }
    log('stored token: ' + (localStorage.getItem('decap-cms:githubToken') || 'â€”noneâ€”'));
    window.addEventListener('message', e => log('message from ' + e.origin + ': ' + (typeof e.data === 'string' ? e.data : JSON.stringify(e.data))));
    document.addEventListener('click', e => {
      if (e.target && e.target.id === 'decap-debug-test') {
        const payload = JSON.stringify({ token: 'TEST_TOKEN_PLACEHOLDER', provider: 'github' });
        window.postMessage(`authorization:github:success:${payload}`, window.location.origin);
        log('emitted simulated authorization message');
      }
    });
  }
})();
</script>

<!-- ðŸ”¹ 2. Hash-to-localStorage fallback (for redirect-based token delivery) -->
<script>
(function () {
  var m = (location.hash || "").match(/\baccess_token=([^&]+)/);
  if (m) {
    try {
      localStorage.setItem("decap-cms:githubToken", decodeURIComponent(m[1]));
    } catch (_) {}
    history.replaceState(null, "", location.pathname + location.search);
  }
})();
</script>

<!-- ðŸ”¹ 3. Load Decap CMS (must come last) -->
<script src="https://unpkg.com/decap-cms@3.8.3/dist/decap-cms.js" data-cfasync="false"></script>

</body>
</html>
