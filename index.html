<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Content Manager</title>
  <link href="/config.yml" type="text/yaml" rel="cms-config-url">
  <style>
    /* Custom CSS for Decap CMS Mobile UX */
    @media (max-width: 768px) {
      /* Hamburger button style */
      .sidebar-toggle {
        display: block;
        position: fixed;
        top: 12px;
        left: 12px;
        z-index: 10000;
        background: #3a3a3a;
        color: white;
        border: 1px solid #555;
        padding: 6px 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 20px;
        line-height: 1;
      }

      /* Sidebar is hidden by default off-screen */
      #nc-root > div > section:first-of-type {
        position: fixed;
        height: 100%;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        z-index: 9999;
        background: #f7f7f7; /* Add a background to overlay content */
        border-right: 1px solid #ccc;
        width: 280px !important; /* Give it a nice width when it slides out */
        min-width: 280px !important;
      }

      /* State when sidebar is open */
      #nc-root.sidebar-open > div > section:first-of-type {
        transform: translateX(0);
      }

      /* Main content area is full-width by default */
      #nc-root > div > main {
        padding-left: 0 !important;
      }

      /* Header overflow fix and padding for the hamburger button */
      #nc-root header {
        flex-wrap: wrap !important;
        padding: 8px 8px 8px 60px !important; /* Add left padding to not overlap with button */
        min-width: 0;
      }
    }
  </style>
</head>
<body>

<!-- ðŸ”¹ 1. Debug Panel (conditionally shown via ?debug=true) -->
<script>
(function () {
  // Only show the debug panel if the ?debug query parameter is present
  if (new URLSearchParams(window.location.search).has('debug')) {
    const panel = document.createElement('div');
    panel.id = 'decap-debug';
    panel.style = 'position:fixed;left:8px;bottom:8px;z-index:99999;background:#111;color:#fff;padding:8px;font-size:12px;border-radius:6px;opacity:.85;max-width:320px';
    panel.innerHTML = '<strong>Decap Debug</strong><div id="decap-debug-log" style="margin-top:6px"></div><button id="decap-debug-test" style="margin-top:6px">Simulate message</button>';
    document.addEventListener('DOMContentLoaded', () => document.body.appendChild(panel));
    function log(m){ const el=document.getElementById('decap-debug-log'); if(!el)return; el.innerHTML += '<div style="margin-top:4px;">'+String(m)+'</div>'; }
    log('stored token: ' + (localStorage.getItem('decap-cms:githubToken') || 'â€”noneâ€”'));
    window.addEventListener('message', e => log('message from ' + e.origin + ': ' + (typeof e.data === 'string' ? e.data : JSON.stringify(e.data))));
    document.addEventListener('click', e => {
      if (e.target && e.target.id === 'decap-debug-test') {
        const payload = JSON.stringify({ token: 'TEST_TOKEN_PLACEHOLDER', provider: 'github' });
        window.postMessage(`authorization:github:success:${payload}`, window.location.origin);
        log('emitted simulated authorization message');
      }
    });
  }
})();
</script>

<!-- ðŸ”¹ 2. Hash-to-localStorage fallback (for redirect-based token delivery) -->
<script>
(function () {
  var m = (location.hash || "").match(/\baccess_token=([^&]+)/);
  if (m) {
    try {
      localStorage.setItem("decap-cms:githubToken", decodeURIComponent(m[1]));
    } catch (_) {}
    history.replaceState(null, "", location.pathname + location.search);
  }
})();
</script>

<!-- ðŸ”¹ 3. Load Decap CMS (must come last) -->
<script src="https://unpkg.com/decap-cms@3.8.3/dist/decap-cms.js" data-cfasync="false"></script>

<!-- ðŸ”¹ 4. Custom script for mobile hamburger sidebar -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  // Only run this on smaller screens
  if (window.innerWidth > 768) {
    return;
  }

  const ncRoot = document.getElementById('nc-root');
  if (!ncRoot) return;

  // Create and inject the hamburger button
  const toggleButton = document.createElement('button');
  toggleButton.innerHTML = '&#9776;'; // Hamburger icon
  toggleButton.className = 'sidebar-toggle';

  // Decap CMS renders its UI after the page loads, so we need to wait for the header to appear.
  // A MutationObserver is a robust way to do this.
  const observer = new MutationObserver(function (mutations, me) {
    const header = ncRoot.querySelector('header');
    if (header) {
      // Inject the button before the header
      header.parentNode.insertBefore(toggleButton, header);
      me.disconnect(); // Stop observing once we've injected the button
    }
  });

  // Start observing the nc-root element for changes
  observer.observe(ncRoot, { childList: true, subtree: true });

  // Add click listener to the button to toggle the sidebar
  toggleButton.addEventListener('click', function () {
    ncRoot.classList.toggle('sidebar-open');
  });

  // Add a listener to the whole container to close the sidebar when a collection link is clicked
  ncRoot.addEventListener('click', function(e) {
    if (ncRoot.classList.contains('sidebar-open') && e.target.closest('a[href^="#/collections/"]')) {
      ncRoot.classList.remove('sidebar-open');
    }
  });
});
</script>

</body>
</html>
